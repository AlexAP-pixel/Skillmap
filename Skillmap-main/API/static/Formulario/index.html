<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="http://127.0.0.1:8000/static/Logo.ico">
    <title>Opcion</title>
    <script src="https://kit.fontawesome.com/3a2cbdeb4d.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="http://127.0.0.1:8000/static/Formulario/styles.css">
    <style>body{display: none;}</style>
</head>
<body>
  <header>
    <img class="logoimg" src="http://127.0.0.1:8000/static/Login/Logo.png">
    <span class="logo">Skillmap</span>
    <nav>
        <div id="navbar">
            <a href="http://127.0.0.1:8000/Skillmap/Inicio">Inicio</a>
            <a href="http://127.0.0.1:8000/Skillmap/Dashboard">Mi cuenta</a>
            <a href="http://127.0.0.1:8000/Skillmap/AboutUs">Acerca de</a>
            <a href="http://127.0.0.1:8000/Skillmap/Contacto">Contacto</a>
            <a href="#" id="cerrar_sesion">Cerrar sesión</a>
        </div>
    </nav>
  </header>
  <br>
  <div class="centered-container">
    <div class="form-container">
        <form id="vocational-form">
            <h1>Formulario de Orientación Vocacional</h1>
            <div class="questions-container">
              <!--
                Mayoría de 1: Carreras como Ingeniería e n Computación, Ingeniería en Informática, Licenciatura en Ciencia de Datos.
                Mayoría de 2: Ingeniería Ambiental, Ingeniería en Energía, Ingeniería en Negocios Energéticos Sustentables.
                Mayoría de 3: Ingeniería Civil, Ingeniero Arquitecto, Ingeniería Topográfica y Fotogramétrica.
                Mayoría de 4: Licenciatura en Física y Matemáticas, Ingeniería Matemática, Ingeniería Mecánica.
              -->
                
                <!-- Pregunta 1 -->
                <label for="res1">1. ¿Qué área de estudio te parece más interesante?</label>
                <div class="options-group">
                  <br>
                    <input type="radio" id="areaA" name="res1" value="A">
                    <label for="areaA">Tecnología y Computación</label>
                    <br>
                    
                    <input type="radio" id= "areaB" name="res1" value="B">
                    <label for="areaB">Ciencias Naturales y Medio Ambiente</label>
                    <br>
                    
                    <input type="radio" id="areaC" name="res1" value="C">
                    <label for="areaC">Diseño y Arquitectura</label>

                    <br>
                  
                    <input type="radio" id="areaD" name="res1" value="D">
                    <label for="areaD">Diseño y Arquitectura</label>
                </div>

                <br><br>

                <!-- Pregunta 2 -->
                <label for="res2">2. ¿Prefieres trabajar en...?</label>
                <div class="options-group">
                  <br>
                  <input type="radio" id="areaA" name="res2" value="A">
                    <label for="areaA">Laboratorios o entornos controlados</label>
                    <br>
                    
                    <input type="radio" id="areaB" name="res2" value="B">
                    <label for="areaB">Oficinas o entornos de desarrollo de software</label>
                    <br>
                    
                    <input type="radio" id="areaC" name="res2" value="C">
                    <label for="areaC">Ambientes al aire libre o en la naturaleza</label>

                    <br>
                  
                    <input type="radio" id="areaD" name="res2" value="D">                    
                    <label for="areaD">Industria y manufactura</label>
                </div>
                <br><br>
                
                <!-- Pregunta 3 -->
                <label for="res3">3. ¿Qué tipo de problemas te gusta resolver?</label>
                <div class="options-group">
                  <br>
                  <input type="radio" id="areaA" name="res3" value="A">
                    <label for="areaA">Problemas complejos de computación</label>
                    <br>
                    
                    <input type="radio" id="areaB" name="res3" value="B">
                    <label for="areaB">Desafíos relacionados con la energía y el medio ambiente</label>
                    <br>
                    
                    <input type="radio" id="areaC" name="res3" value="C">
                    <label for="areaC">Cuestiones de diseño y construcción</label>

                    <br>
                  
                    <input type="radio" id="areaD" name="res3" value="D">
                    <label for="areaD">Problemas matemáticos o físicos</label>
                </div>
                <br><br>

                <!-- Pregunta 4 -->
                <label for="res4">4. ¿Qué materias escolares te interesan más?</label>
                <div class="options-group">
                  <br>
                  <input type="radio" id="areaA" name="res4" value="A">                    
                  <label for="areaA">Biología y Química</label>
                    <br>
                    
                    <input type="radio" id="areaB" name="res4" value="B">                    
                    <label for="areaB">Informática y Tecnología</label>
                    <br>
                    
                    <input type="radio" id="areaC" name="res4" value="C">                    
                    <label for="areaC">Arte y Diseño</label>

                    <br>
                  
                    <input type="radio" id="areaD" name="res4" value="D">                    
                    <label for="areaD">Física y Matemáticas</label>
                </div>
                <br><br>

                <!-- Pregunta 5 -->
                <label for="res5">5. ¿Te consideras una persona que...?</label>
                <div class="options-group">
                  <br>
                  <input type="radio" id="areaA" name="res5" value="A">                    
                  <label for="areaA">Disfruta innovando y creando nuevas tecnologías</label>
                    <br>
                    
                    <input type="radio" id="areaB" name="res5" value="B">                    
                    <label for="areaB">Se preocupa por el medio ambiente y la sostenibilidad</label>
                    <br>
                    
                    <input type="radio" id="areaC" name="res5" value="C">                    
                    <label for="areaC">Es detallista y disfruta del diseño y la construcción</label>
                    <br>

                    <input type="radio" id="areaD" name="res5" value="D">                    
                    <label for="areaD">Ama los números y los análisis complejos</label>
                </div>
                <br><br>

                <!-- Pregunta 6 -->
                <label for="res6">6. ¿Qué te gustaría mejorar o cambiar en el mundo?</label>
                <div class="options-group">
                  <br>
                  <input type="radio" id="areaA" name="res6" value="A">                    
                  <label for="areaA">Avances tecnológicos y digitales</label>
                    <br>
                    
                    <input type="radio" id="areaB" name="res6" value="B">                    
                    <label for="areaB">Protección ambiental y uso de energías renovables</label>
                    <br>
                    
                    <input type="radio" id="areaC" name="res6" value="C">                    
                    <label for="areaC">Diseño urbano y arquitectura</label>
                    <br>

                    <input type="radio" id="areaD" name="res6" value="D">                    
                    <label for="areaD">Descubrimientos científicos y matemáticos</label>
                </div>
                <br><br>

                <!-- Pregunta 7 -->
                <label for="res7">7. ¿Prefieres trabajar...?</label>
                <div class="options-group">
                  <br>
                  <input type="radio" id="areaA" name="res7" value="A">                    
                  <label for="areaA">Solo, enfocado en tareas específicas</label>
                    <br>
                    
                    <input type="radio" id="areaB" name="res7" value="B">                    
                    <label for="areaB">En equipo, colaborando en proyectos</label>
                    <br>
                    
                    <input type="radio" id="areaC" name="res7" value="C">                    
                    <label for="areaC">En el campo, interactuando con el entorno</label>
                    <br>

                    <input type="radio" id="areaD" name="res7" value="D">                    
                    <label for="areaD">En un laboratorio o entorno de investigación</label>
                </div>
                <br><br>
                <!-- Pregunta 8 -->
                <label for="res8">8. ¿Qué tipo de tecnología te interesa más?</label>
                <div class="options-group">
                  <br>
                  <input type="radio" id="areaA" name="res8" value="A">                    
                  <label for="areaA">Software y programación</label>
                    <br>
                    
                    <input type="radio" id="areaB" name="res8" value="B">                    
                    <label for="areaB">Energías renovables y sostenibles</label>
                    <br>
                    
                    <input type="radio" id="areaC" name="res8" value="C">                    
                    <label for="areaC">Máquinas y mecanismos</label>
                    <br>

                    <input type="radio" id="areaD" name="res8" value="D">                    
                    <label for="areaD">Robótica y automatización</label>
                </div>
                <br><br>

                <!-- Pregunta 9 -->
                <label for="res9">9. ¿Cómo te gustaría aplicar tus conocimientos?</label>
                <div class="options-group">
                  <br>
                  <input type="radio" id="areaA" name="res9" value="A">                    
                  <label for="areaA">Desarrollando nuevas aplicaciones o software</label>
                    <br>
                    
                    <input type="radio" id="areaB" name="res9" value="B">                    
                    <label for="areaB">Contribuyendo a proyectos de energía sostenible</label>
                    <br>
                    
                    <input type="radio" id="areaC" name="res9" value="C">                    
                    <label for="areaC">Diseñando estructuras o productos</label>
                    <br>

                    <input type="radio" id="areaD" name="res9" value="D">                    
                    <label for="areaD">Realizando investigaciones científicas</label>
                </div>
                <br><br>

                <!-- Pregunta 10 -->
                <label for="res10">10. ¿Qué importancia le das a la innovación en tu carrera?</label>
                <div class="options-group">
                  <br>
                  <input type="radio" id="areaA" name="res10" value="A">                    
                  <label for="areaA">Alta, quiero estar en el frente de la innovación tecnológica</label>
                    <br>
                    
                    <input type="radio" id="areaB" name="res10" value="B">                    
                    <label for="areaB">Moderada, prefiero mejorar y optimizar lo existente</label>
                    <br>
                    
                    <input type="radio" id="areaC" name="res10" value="C">                    
                    <label for="areaC">Variable, depende del proyecto en el que trabaje</label>
                    <br>

                    <input type="radio" id="areaD" name="res10" value="D">                    
                    <label for="areaD">Baja, me enfoco más en la aplicación práctica de conocimientos existentes</label>
                </div>
                <br><br>

                <!-- Pregunta 11 -->
                <label for="res11">11. Cuando piensas en un proyecto ideal, ¿qué elemento es más importante para ti?</label>
                <div class="options-group">
                  <br>
                  <input type="radio" id="areaA" name="res11" value="A">                    
                  <label for="areaA">Que involucre la última tecnología y software</label>
                    <br>
                    
                    <input type="radio" id="areaB" name="res11" value="B">                    
                    <label for="areaB">Que tenga un impacto positivo en el medio ambiente</label>
                    <br>
                    
                    <input type="radio" id="areaC" name="res11" value="C">                    
                    <label for="areaC">Que requiera diseño creativo y práctico</label>
                    <br>

                    <input type="radio" id="areaD" name="res11" value="D">                    
                    <label for="areaD">Que esté basado en principios científicos y matemáticos</label>
                </div>
                <br><br>

                <!-- Pregunta 12 -->
                <label for="res12">12. ¿Qué te motiva más a aprender algo nuevo?</label>
                <div class="options-group">
                  <br>
                  <input type="radio" id="areaA" name="res12" value="A">                    
                  <label for="areaA">La posibilidad de crear o mejorar tecnologías digitales</label>
                    <br>
                    
                    <input type="radio" id="areaB" name="res12" value="B">                    
                    <label for="areaB">La oportunidad de hacer un cambio significativo en el mundo</label>
                    <br>
                    
                    <input type="radio" id="areaC" name="res12" value="C">                    
                    <label for="areaC">El desafío de resolver problemas de diseño estructural</label>
                    <br>

                    <input type="radio" id="areaD" name="res12" value="D">                    
                    <label for="areaD">El interés en teorías científicas y descubrimientos</label>
                </div>
                <br><br>

                <!-- Pregunta 13 -->
                <label for="res13">13. ¿Cómo describirías tu enfoque para resolver problemas?</label>
                <div class="options-group">
                  <br>
                  <input type="radio" id="areaA" name="res13" value="A">                    
                  <label for="areaA">Innovador y centrado en la tecnología</label>
                    <br>
                    
                    <input type="radio" id="areaB" name="res13" value="B">                    
                    <label for="areaB">Consciente del medio ambiente y orientado a la sostenibilidad</label>
                    <br>
                    
                    <input type="radio" id="areaC" name="res13" value="C">                    
                    <label for="areaC">Práctico y basado en principios de diseño</label>
                    <br>

                    <input type="radio" id="areaD" name="res13" value="D">                    
                    <label for="areaD">Analítico y basado en principios matemáticos</label>
                </div>
                <br><br>

                <!-- Final de preguntas-->
            </div>
            <div class="custom-popup" id="customPopup" style="color: white">
              <span class="popup-message" id="popupMessage"></span>
            </div>
            <!-- Boton para enviar las respuestas-->
            <button type="button" id="enviarRespuestas">Enviar Respuestas</button>
        </form>
    </div>
  </div>
  <br><br><br><br><br><br><br><br><br>
  <footer>
      <p>
          <i class="fa-solid fa-envelope"></i> <a href="mailto:skillmap2024@gmail.com"> skillmap2024@outlook.com</a><span style="margin-right: 100px;"></span>
          <i class="fa fa-phone"></i> <a href="tel:5611670871"> 5611670871</a>
      </p>
      <p>&copy; 2023 Skillmap. Todos los derechos reservados</p>
  </footer>
</body>
<script>
  async function verificarAutenticacion() {
    const response = await fetch('http://127.0.0.1:8000/user/me', {
      method: 'GET',
      headers: {
        'Authorization': 'Bearer ' + localStorage.getItem('access_token')
      }
    });
    window.data = await response.json();
    data = window.data
    if (!response.ok || data.error) {
      window.location.href = 'http://127.0.0.1:8000/Skillmap/';
    }else{
      document.body.style.display = 'block';
      cargarRespuestas();
    }
  }
  async function cargarRespuestas() {
    try {
      const response = await fetch(`http://127.0.0.1:8000/answers?correo=${encodeURIComponent(data.correo)}`, {
        method: 'GET',
        headers: {
          'Authorization': 'Bearer ' + localStorage.getItem('access_token')
        }
      });
      const respuestasUsuario = await response.json();
      for (const [pregunta, respuesta] of Object.entries(respuestasUsuario)) {
        const radioButton = document.querySelector(`input[name="${pregunta}"][value="${respuesta}"]`);
        if (radioButton) {
          radioButton.checked = true;
        }
      }
    } catch (error) {
      console.error('Error al cargar respuestas:', error.message);
    }
  }
  verificarAutenticacion();
  document.getElementById('cerrar_sesion').addEventListener('click', function() {
    localStorage.removeItem('access_token');
    window.location.href = 'http://127.0.0.1:8000/Skillmap/';
  });

  document.addEventListener("DOMContentLoaded", function() {
    const form = document.getElementById("vocational-form");

    const radioButtons = form.querySelectorAll('input[type="radio"]');
    radioButtons.forEach(function(radioButton) {
      radioButton.addEventListener("change", function() {
        const pregunta = radioButton.getAttribute("name");
        const respuesta = radioButton.value;
        actualizarBaseDeDatos(pregunta, respuesta);
      });
    });
  });

  async function actualizarBaseDeDatos(parametro, valor) {
    correo = (window.data).correo
    const response = await fetch(`http://127.0.0.1:8000/answers?correo=${encodeURIComponent(correo)}&parametro=${parametro}&valor=${valor}`,{
      method: 'PATCH',
      headers: {
          'Content-Type': 'application/json',
      },
    });
    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }
  }
  document.getElementById('enviarRespuestas').addEventListener('click', async function() {
    let formLleno = true
    try {
      const response = await fetch(`http://127.0.0.1:8000/answers?correo=${encodeURIComponent(data.correo)}`, {
        method: 'GET',
        headers: {
          'Authorization': 'Bearer ' + localStorage.getItem('access_token')
        }
      });
      const respuestasUsuario = await response.json();
      for (const [pregunta, respuesta] of Object.entries(respuestasUsuario)) {
        if (respuesta === " "){
          formLleno = false;
          break;
        }
      }
      if (!formLleno){
        showCustomPopup("Completa el formulario antes de continuar",2000,"#ec5353")
      }else{
        console.log("form_completo")
        actualizarBaseDeDatos("formulario", true)
        setTimeout(() => {
          window.location.href = 'http://127.0.0.1:8000/Skillmap/Empezar';
      }, 1000);
      }
    } catch (error) {
      console.error('Error al cargar respuestas:', error.message);
    }
  });
  function showCustomPopup(message, duration, backgroundColor) {
    const customPopup = document.getElementById('customPopup');
    const popupMessage = document.getElementById('popupMessage');

    customPopup.style.backgroundColor = backgroundColor;

    popupMessage.textContent = message;
    customPopup.style.display = 'block';

    customPopup.style.animation = 'slideDown 0.5s';

    setTimeout(() => {
        customPopup.style.animation = 'slideUp 0.5s';
        setTimeout(() => {
            customPopup.style.display = 'none';
            customPopup.style.animation = '';
        }, 500);
    }, duration);
  }
</script>
</html>